<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body{
            display: flex;
            flex-direction: column;
            gap: 60px;
        }
        .block{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 40px;
        }
        div,input, #msg{
            font-size: 40px;
        }
    </style>
</head>
<body>
<div class="block">
    <div id="state">狀態：</div>
    <div id="stateMsg"></div>
</div>
<div class="block">
    <div id="msg"></div>
</div>
<div class="block">
    <input id="start" type="button" value="Start"/>
</div>

<script>
    window.onload = ()=> {
        document.getElementById('start').addEventListener('click', ()=>{
            getStateKeys();
            runGeoApi();
        })
    }

    const envKey = {"IOS": 0, "ANDROID": 1, "WEB": 2};
    function checkEnv() {
        console.log('Checking environment...');
        console.log('window.jsHandlers:', window.jsHandlers);
        console.log('typeof window.jsHandlers.OpenAndroidLocation:', typeof window.jsHandlers?.OpenAndroidLocation);
        console.log('window.webkit:', window.webkit);
        console.log('window.webkit.messageHandlers:', window.webkit?.messageHandlers);
        console.log('window.webkit.messageHandlers.OpenIOSLocation:', window.webkit?.messageHandlers?.OpenIOSLocation);
        console.log('navigator.geolocation:', navigator.geolocation);

        switch (true) {
            case (window.jsHandlers && typeof window.jsHandlers.OpenAndroidLocation === "function"):
                console.log('Android environment detected');
                return envKey.ANDROID;
            case (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.OpenIOSLocation):
                console.log('iOS environment detected');
                return envKey.IOS;
            case ("geolocation" in navigator):
                console.log('Web environment detected');
                return envKey.WEB;
        }
    }

    function runGeoApi() {
        switch (checkEnv()) {
            case envKey.ANDROID:
                window.jsHandlers.OpenAndroidLocation();
                break
            case envKey.IOS:
                window.webkit.messageHandlers.OpenIOSLocation.postMessage(null);
                break
            case envKey.WEB:
                // navigator.geolocation //如果需要執行才呼叫
                break
        }
    }

    function getLocation(lat, lng) {
        // do some thing..
        showStateMessage(`${lat},${lng}`)
    }
///////////////////////////////////////////////////////////////////
    function getStateKeys() {
        const stateMsg = document.getElementById('stateMsg')
        switch (checkEnv()) {
            case envKey.ANDROID:
                stateMsg.textContent = envKey.ANDROID
                return
            case envKey.IOS:
                stateMsg.textContent = envKey.IOS
                return;
            case envKey.WEB:
                // navigator.geolocation //如果需要執行才呼叫
                return;
        }
    }

    function showStateMessage(message) {
        document.getElementById("msg").textContent = message;
    }

</script>
</body>
</html>
